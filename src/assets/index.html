<html>
<head>
    <meta charset="UTF-8">
    <title>App Park</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        html {
            font-size: 0;
            font-family: sans-serif;
            color: #131313;
            background-color: white;
            -webkit-user-select: none;
            -moz-user-select: none;
            user-select: none;
        }

        body {
            margin: 0;
        }

        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
        }

        .header > .title {
            margin-right: 12px;
            font-size: 38px;
            font-weight: bold;
        }

        .header > .help {
            color: rgb(0, 122, 255);
            font-size: 18px;
            cursor: pointer;
        }

        .apps {
            text-align: center;
            padding: 12px;
        }

        .app {
            position: relative;
            display: inline-flex;
            width: 340px;
            align-items: center;
            margin: 8px;
            padding: 8px;
            text-align: left;
            border: 1px solid rgb(168, 168, 168, 0.2);
            border-radius: 12px;
        }

        .app > .icon {
            width: 64px;
            height: 64px;
            border-radius: 20%;
            background-color: white;
            background-image: url('data:image/png;base64,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');
            background-size: contain;   
        }

        .app > .info {
            flex: 1;
            padding: 0 12px;
            overflow: hidden;
        }

        .app > .info > .name {
            font-size: 18px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .app > .info > .version {
            font-size: 14px;
            color: darkgrey;
        }

        .app > .info > .date {
            font-size: 14px;
            color: darkgrey;
        }

        .app > .right {
            display: flex;
            flex-direction: column;
            align-items: center;
            transform: translateY(6px);
        }

        .app > .right > .install {
            padding: 4px 20px;
            font-size: 16px;
            font-weight: bold;
            color: rgb(60, 133, 246);
            background-color: rgb(238, 237, 240);
            border-radius: 14px;
            text-decoration: none;
        }

        .app > .right > .install::before {
            content: 'GET';
        }

        .app > .right > .size {
            margin-top: 2px;
            font-size: 10px;
            color: darkgray;
        }

        @media only screen and (max-width: 768px) {
            .app {
                display: flex;
                width: auto;
                margin: 0 0 16px 0;
                padding: 0;
                border: none;
            }

            .app:not(:last-child)::after {
                content: '';
                position: absolute;
                bottom: -8px;
                right: 0;
                width: calc(100% - 64px - 12px);
                height: 1px;
                background: darkgrey;
                opacity: 0.2;
            }
        }

        @media (prefers-color-scheme: dark) {
            html {
                color: #F0F0F0;
                background-color: #131313;
            }

            .app > .right > .install {
                background-color: rgb(40, 40, 40);
            }
        }
    </style>
    <script>
        document.addEventListener('DOMContentLoaded', documentReady, false);

        function documentReady() {
            document.getElementById('help').addEventListener('click', () => {
                if (window.confirm([
                    'Having trouble installing apps?',
                    'The signature of the app you are trying to install maybe expired or wasn\'t even correct in the first place. Check your binary or ask the developer in charge.',
                    'If you are trying to install an Enterprise signed app, you may need to trust the company in the Settings app. Check out Apple\'s official support page for more information.',
                    'Open Apple\'s Support page concerning Enterprise Apps?'
                ].join('\n\n'))) {
                    window.open('https://support.apple.com/en-us/HT204460', '_blank');
                }
            });

            fetch('/apps')
                .then(response => response.json())
                .then(data => createApps(data));

            function createApps(apps) {
                for (const app of apps) {
                    const elem = document.createElement('div');
                    elem.classList.add('app');
                    
                    const icon = document.createElement('img');
                    icon.classList.add('icon');
                    if (app.icon) {
                        icon.src = 'data:image/png;base64,' + app.icon;
                    }

                    const info = document.createElement('div');
                    info.classList.add('info');

                    const name = document.createElement('div');
                    name.classList.add('name');
                    name.innerText = app.name;

                    const options = { dateStyle: 'short', timeStyle: 'short' };
                    const modified = new Date(app.date);

                    const date = document.createElement('div');
                    date.classList.add('date');
                    date.innerText = modified.toLocaleString(undefined, options);

                    const version = document.createElement('div');
                    version.classList.add('version');
                    version.innerText = `${app.version} (${app.build})`;

                    const right = document.createElement('div');
                    right.classList.add('right');

                    const install = document.createElement('a');
                    install.classList.add('install');
                    install.href = `itms-services://?action=download-manifest&url=${window.location.href}apps/${app.id}/manifest`

                    const size = document.createElement('div');
                    size.classList.add('size');
                    size.innerText = humanFileSize(app.size);

                    info.append(name, date, version);
                    right.append(install, size);
                    elem.append(icon, info, right);
                    document.getElementById('apps').append(elem);

                    icon.onerror = () => {
                        icon.remove();
                        const blank = document.createElement('img');
                        blank.classList.add('icon');
                        elem.insertBefore(blank, info);
                    };
                }   
            }
        
            function humanFileSize(bytes) {
                if (Math.abs(bytes) < 1000) {
                    return bytes + ' B';
                }
                const units = ['kB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];
                let u = -1;
                const r = 10;
                do {
                    bytes /= 1000;
                    ++u;
                } while (Math.round(Math.abs(bytes) * r) / r >= 1000 && u < units.length - 1);
                return bytes.toFixed(1) + ' ' + units[u];
            }
        }
    </script>
</head>
<body>
    <div class="header">
        <div class="title">App Park</div>
        <div id="help" class="help">Help</div>
    </div>
    <div id="apps" class="apps"></div>
</body>
</html>